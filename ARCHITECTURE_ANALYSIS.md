# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ê–Ω–∞–ª–∏–∑: Chess Telegram Mini App
## –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –®–∞—Ö–º–∞—Ç–Ω–æ–µ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 23 –Ω–æ—è–±—Ä—è 2025
**–¶–µ–ª—å:** –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —à–∞—Ö–º–∞—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è Chess.com/Lichess

---

## üìä –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ

### –°–∏–ª—å–Ω—ã–µ –°—Ç–æ—Ä–æ–Ω—ã ‚úÖ

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
   - –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ frontend (React + TypeScript) / backend (NestJS)
   - Monorepo —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ workspace
   - Type-safety –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
   - WebSocket –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

2. **–ë–∞–∑–æ–≤–∞—è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
   - ‚úÖ –ò–≥—Ä–∞ —Å AI (Stockfish WASM –Ω–∞ frontend)
   - ‚úÖ –û–Ω–ª–∞–π–Ω –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä —á–µ—Ä–µ–∑ WebSocket
   - ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ö–æ–¥–æ–≤ (chess.js)
   - ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —à–∞—Ö/–º–∞—Ç/–ø–∞—Ç
   - ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Mini Apps SDK
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤ (UCI/SAN notation)
   - ‚úÖ PGN –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

3. **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫:**
   - Modern React 19 + Vite
   - NestJS (enterprise-grade framework)
   - Prisma ORM (type-safe DB)
   - PostgreSQL + Redis
   - Socket.io –¥–ª—è WebSocket

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ü—Ä–æ–±–ª–µ–º—ã ‚ùå

1. **Backend Stockfish - Mock –†–µ–∞–ª–∏–∑–∞—Ü–∏—è**
   - –°–µ–π—á–∞—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ —Ö–æ–¥—ã –≤–º–µ—Å—Ç–æ –∞–Ω–∞–ª–∏–∑–∞
   - –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–≤–∏–∂–∫–æ–º
   - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞–Ω–∞–ª–∏–∑ –ø–æ–∑–∏—Ü–∏–π

2. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –î–æ–ª–≥:**
   - –°–º–µ—à–µ–Ω–∏–µ TypeORM + Prisma (–º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
   - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (legacy + NestJS modules)
   - –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (react-chessboard, TensorFlow)

3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
   - ‚ùå –í—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å (blitz, rapid, classical)
   - ‚ùå –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (Elo/Glicko-2)
   - ‚ùå –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä—Ç–∏–π
   - ‚ùå –î–µ–±—é—Ç–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
   - ‚ùå –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞–∑–ª—ã
   - ‚ùå –¢—É—Ä–Ω–∏—Ä—ã
   - ‚ùå –û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
   - ‚ùå –≠–Ω–¥—à–ø–∏–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (Syzygy)

---

## üéØ –ê–Ω–∞–ª–∏–∑ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

### Chess.com (–õ–∏–¥–µ—Ä –†—ã–Ω–∫–∞)

**–ö–ª—é—á–µ–≤—ã–µ –§–∏—á–∏:**
- 100M+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ—Å–ª–µ–º–∞—Ç—á–µ–≤—ã–π –∞–Ω–∞–ª–∏–∑ —Å Stockfish (–≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, –æ—à–∏–±–∫–∏)
- –¢—ã—Å—è—á–∏ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞–∑–ª–æ–≤ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–µ–π
- –û–±—É—á–∞—é—â–∏–µ –∫—É—Ä—Å—ã –æ—Ç –≥—Ä–æ—Å—Å–º–µ–π—Å—Ç–µ—Ä–æ–≤
- –¢—É—Ä–Ω–∏—Ä—ã (bullet, blitz, rapid, classical)
- –í–∞—Ä–∏–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏: 1+0, 3+2, 5+5, 10+0, 15+10, 30+0
- Leaderboards –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –°—Ç—Ä–∏–º—ã –∏ –≤–∏–¥–µ–æ-–∫–æ–Ω—Ç–µ–Ω—Ç
- Fair Play —Å–∏—Å—Ç–µ–º–∞ (–∞–Ω—Ç–∏—á–∏—Ç)

**–ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å:**
- Freemium (–±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã)
- Premium –ø–æ–¥–ø–∏—Å–∫–∞ ($5-15/–º–µ—Å—è—Ü)

### Lichess (Open-Source –ß–µ–º–ø–∏–æ–Ω)

**–ö–ª—é—á–µ–≤—ã–µ –§–∏—á–∏:**
- 100% –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Stockfish –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –í–°–ï–• –ø–∞—Ä—Ç–∏–π
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: 6 –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤ –ø–∞—Ä—Ç–∏–π
- Opening Explorer (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–µ–±—é—Ç–æ–≤)
- Puzzle Rush, Puzzle Storm
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 80+ —è–∑—ã–∫–æ–≤
- Broadcasts –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤
- Study —Ä–µ–∂–∏–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è
- –í–∞—Ä–∏–∞–Ω—Ç—ã —à–∞—Ö–º–∞—Ç (Chess960, Crazyhouse, Atomic –∏ —Ç.–¥.)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Scala + Play Framework (backend)
- MongoDB (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- Redis (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- Stockfish (–∞–Ω–∞–ª–∏–∑)

---

## üöÄ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –°–∏—Å—Ç–µ–º–∞ –®–∞—Ö–º–∞—Ç–Ω—ã—Ö –î–≤–∏–∂–∫–æ–≤ (–ö–†–ò–¢–ò–ß–ù–û)

#### –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–∫-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Stockfish. –≠—Ç–æ –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.

#### –†–µ—à–µ–Ω–∏–µ: Multi-Engine Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Chess Engine Manager Service             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - Load balancing –º–µ–∂–¥—É –¥–≤–∏–∂–∫–∞–º–∏                   ‚îÇ
‚îÇ  - Priority queue –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞                      ‚îÇ
‚îÇ  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π (Redis)                     ‚îÇ
‚îÇ  - Rate limiting                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ            ‚îÇ              ‚îÇ
           ‚ñº            ‚ñº              ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇStockfish ‚îÇ  ‚îÇ  Leela   ‚îÇ  ‚îÇ  Komodo  ‚îÇ
    ‚îÇ  16/17   ‚îÇ  ‚îÇChess Zero‚îÇ  ‚îÇ  Dragon  ‚îÇ
    ‚îÇ(default) ‚îÇ  ‚îÇ  (LC0)   ‚îÇ  ‚îÇ(premium) ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ             ‚îÇ              ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  Redis Cache   ‚îÇ
              ‚îÇ (Position DB)  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –î–≤–∏–∂–∫–∏:**

1. **Stockfish 17** (PRIMARY ENGINE)
   - –†–µ–π—Ç–∏–Ω–≥: Elo 3759
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: Default –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –†–µ–∂–∏–º—ã:
     - Quick analysis (depth 15-18, 1-3 —Å–µ–∫)
     - Deep analysis (depth 25-30, 10-60 —Å–µ–∫, premium)
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: UCI protocol —á–µ—Ä–µ–∑ child_process
   - –í–µ—Ä—Å–∏–∏: Stockfish AVX2, Stockfish NNUE

2. **Leela Chess Zero (LC0)** (PREMIUM ENGINE)
   - –†–µ–π—Ç–∏–Ω–≥: Elo 3700+
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: Premium –ø–æ–¥–ø–∏—Å—á–∏–∫–∏
   - –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
     - –ù–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å (–±–æ–ª–µ–µ "—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è" –∏–≥—Ä–∞)
     - –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
     - –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ
   - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: GPU –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

3. **Komodo Dragon** (PERSONALITY ENGINE)
   - –†–µ–π—Ç–∏–Ω–≥: Elo 3634
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –û–±—É—á–µ–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏
   - –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
     - Personality modes (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π, –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π, –∏ —Ç.–¥.)
     - –ú–æ–∂–Ω–æ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
     - Multi-PV (–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Backend Engine Service:**

```typescript
// backend/src/engine/engine.module.ts
@Module({
  providers: [
    EngineManagerService,
    StockfishEngineService,
    LeelaEngineService,
    KomodoEngineService,
    EngineCacheService,
  ],
  exports: [EngineManagerService],
})
export class EngineModule {}

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –¥–≤–∏–∂–∫–æ–≤
interface ChessEngine {
  initialize(): Promise<void>;
  analyzePosition(fen: string, options: AnalysisOptions): Promise<AnalysisResult>;
  getBestMove(fen: string, timeLimit: number): Promise<MoveResult>;
  evaluatePosition(fen: string): Promise<Evaluation>;
  stopAnalysis(): void;
  quit(): void;
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
interface AnalysisResult {
  bestMove: string;           // UCI notation
  evaluation: number;          // centipawns
  depth: number;
  nodes: number;
  nps: number;                 // nodes per second
  pv: string[];               // principal variation
  multipv?: string[][];       // multiple variations
  mate?: number;              // moves to mate
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```typescript
// Stockfish —á–µ—Ä–µ–∑ UCI
class StockfishEngineService implements ChessEngine {
  private process: ChildProcess;
  private queue: PriorityQueue<AnalysisJob>;

  async initialize() {
    this.process = spawn('stockfish', [], {
      stdio: ['pipe', 'pipe', 'pipe']
    });
    await this.sendCommand('uci');
    await this.sendCommand('setoption name Hash value 2048');
    await this.sendCommand('setoption name Threads value 4');
  }

  async analyzePosition(fen: string, options: AnalysisOptions) {
    const cacheKey = `analysis:${fen}:${options.depth}`;
    const cached = await this.cache.get(cacheKey);
    if (cached) return cached;

    await this.sendCommand(`position fen ${fen}`);
    await this.sendCommand(`go depth ${options.depth}`);

    const result = await this.waitForBestMove();
    await this.cache.set(cacheKey, result, 3600); // 1 hour TTL
    return result;
  }
}
```

**Docker Compose –¥–ª—è –¥–≤–∏–∂–∫–æ–≤:**

```yaml
services:
  stockfish:
    image: niklasf/stockfish:latest
    container_name: stockfish-engine
    command: stockfish
    volumes:
      - ./engine-data:/data
    networks:
      - chess-network
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4G

  lc0:
    image: lczero/lc0:latest
    container_name: leela-engine
    volumes:
      - ./lc0-weights:/weights
    runtime: nvidia  # –î–ª—è GPU
    environment:
      - CUDA_VISIBLE_DEVICES=0
    networks:
      - chess-network
```

---

### 2. –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è –°–∏—Å—Ç–µ–º–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Glicko-2 Rating System**

–ü–æ—á–µ–º—É Glicko-2, –∞ –Ω–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π Elo:
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–∞ (RD - Rating Deviation)
- ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–∞
- ‚úÖ –ë–æ–ª–µ–µ —Ç–æ—á–µ–Ω –¥–ª—è –æ–Ω–ª–∞–π–Ω-–∏–≥—Ä
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Lichess, Chess.com

**Prisma Schema:**

```prisma
model User {
  id            String   @id @default(uuid())
  telegramId    Int      @unique
  username      String

  // Glicko-2 Ratings (–ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—é)
  bulletRating  Int      @default(1500)
  bulletRD      Float    @default(350.0)  // Rating Deviation
  bulletVol     Float    @default(0.06)   // Volatility

  blitzRating   Int      @default(1500)
  blitzRD       Float    @default(350.0)
  blitzVol      Float    @default(0.06)

  rapidRating   Int      @default(1500)
  rapidRD       Float    @default(350.0)
  rapidVol      Float    @default(0.06)

  classicalRating Int    @default(1500)
  classicalRD    Float   @default(350.0)
  classicalVol   Float   @default(0.06)

  // AI ratings (–æ—Ç–¥–µ–ª—å–Ω–æ)
  aiRating      Int      @default(1500)
  aiRD          Float    @default(350.0)

  lastRatingUpdate DateTime @default(now())
  gamesPlayed   Int      @default(0)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Game {
  // ... existing fields
  timeControl   String   // "bullet", "blitz", "rapid", "classical"
  timeLimit     Int      // seconds
  timeIncrement Int      // seconds per move

  whiteRatingBefore Int
  whiteRatingAfter  Int?
  blackRatingBefore Int
  blackRatingAfter  Int?

  isRated       Boolean  @default(true)
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```typescript
// backend/src/rating/glicko2.service.ts
export class Glicko2Service {
  private readonly TAU = 0.5; // System constant

  calculateNewRating(
    player: GlickoRating,
    opponents: GlickoRating[],
    results: number[] // 1 = win, 0.5 = draw, 0 = loss
  ): GlickoRating {
    // Glicko-2 algorithm implementation
    // See: http://www.glicko.net/glicko/glicko2.pdf

    const mu = (player.rating - 1500) / 173.7178;
    const phi = player.rd / 173.7178;
    const sigma = player.volatility;

    // ... calculations

    return {
      rating: newRating,
      rd: newRD,
      volatility: newSigma
    };
  }

  async updateRatingsAfterGame(game: Game) {
    const white = await this.userRepo.findById(game.whitePlayerId);
    const black = await this.userRepo.findById(game.blackPlayerId);

    const timeControl = this.getTimeControl(game.timeLimit);
    const result = this.getGameResult(game);

    // Calculate new ratings
    const whiteNew = this.calculateNewRating(
      { rating: white[`${timeControl}Rating`], ... },
      [{ rating: black[`${timeControl}Rating`], ... }],
      [result]
    );

    // Update database
    await this.userRepo.update(white.id, {
      [`${timeControl}Rating`]: whiteNew.rating,
      [`${timeControl}RD`]: whiteNew.rd,
      [`${timeControl}Vol`]: whiteNew.volatility,
    });
  }
}
```

---

### 3. –í—Ä–µ–º–µ–Ω–Ω–æ–π –ö–æ–Ω—Ç—Ä–æ–ª—å (Time Controls)

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∫–∞–∫ Chess.com/Lichess):**

```typescript
enum TimeControl {
  BULLET = 'bullet',      // < 3 minutes
  BLITZ = 'blitz',        // 3-10 minutes
  RAPID = 'rapid',        // 10-30 minutes
  CLASSICAL = 'classical' // > 30 minutes
}

interface TimeControlPreset {
  name: string;
  category: TimeControl;
  initial: number;    // seconds
  increment: number;  // seconds per move
  display: string;
}

const TIME_CONTROLS: TimeControlPreset[] = [
  // Bullet
  { name: 'Bullet 1+0', category: TimeControl.BULLET, initial: 60, increment: 0, display: '1 min' },
  { name: 'Bullet 1+1', category: TimeControl.BULLET, initial: 60, increment: 1, display: '1+1' },
  { name: 'Bullet 2+1', category: TimeControl.BULLET, initial: 120, increment: 1, display: '2+1' },

  // Blitz
  { name: 'Blitz 3+0', category: TimeControl.BLITZ, initial: 180, increment: 0, display: '3 min' },
  { name: 'Blitz 3+2', category: TimeControl.BLITZ, initial: 180, increment: 2, display: '3+2' },
  { name: 'Blitz 5+0', category: TimeControl.BLITZ, initial: 300, increment: 0, display: '5 min' },
  { name: 'Blitz 5+3', category: TimeControl.BLITZ, initial: 300, increment: 3, display: '5+3' },

  // Rapid
  { name: 'Rapid 10+0', category: TimeControl.RAPID, initial: 600, increment: 0, display: '10 min' },
  { name: 'Rapid 15+10', category: TimeControl.RAPID, initial: 900, increment: 10, display: '15+10' },

  // Classical
  { name: 'Classical 30+0', category: TimeControl.CLASSICAL, initial: 1800, increment: 0, display: '30 min' },
];
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞:**

```typescript
// backend/src/game/game-clock.service.ts
export class GameClockService {
  private clocks = new Map<string, GameClock>();

  startClock(gameId: string, playerColor: 'white' | 'black') {
    const clock = this.clocks.get(gameId);
    clock.activePlayer = playerColor;
    clock.lastMoveTime = Date.now();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    clock.interval = setInterval(() => {
      this.checkTimeRemaining(gameId);
    }, 1000);
  }

  async makeMove(gameId: string, playerColor: 'white' | 'black') {
    const clock = this.clocks.get(gameId);
    const elapsed = Date.now() - clock.lastMoveTime;

    // –í—ã—á–∏—Ç–∞–µ–º –≤—Ä–µ–º—è
    clock[`${playerColor}Time`] -= elapsed / 1000;

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
    clock[`${playerColor}Time`] += clock.increment;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É
    if (clock[`${playerColor}Time`] <= 0) {
      await this.handleTimeout(gameId, playerColor);
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —á–∞—Å—ã
    this.startClock(gameId, playerColor === 'white' ? 'black' : 'white');
  }

  async handleTimeout(gameId: string, player: 'white' | 'black') {
    const game = await this.gameService.findById(gameId);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª
    if (this.hasInsufficientMaterial(game, player === 'white' ? 'black' : 'white')) {
      await this.gameService.finish(gameId, 'draw', 'timeout_vs_insufficient_material');
    } else {
      await this.gameService.finish(gameId, player === 'white' ? 'black' : 'white', 'timeout');
    }
  }
}
```

**WebSocket —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**

```typescript
// –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
@SubscribeMessage('clock-tick')
handleClockTick(gameId: string) {
  const clock = this.clockService.getClock(gameId);
  this.server.to(gameId).emit('clock-update', {
    whiteTime: clock.whiteTime,
    blackTime: clock.blackTime,
    activePlayer: clock.activePlayer
  });
}
```

---

### 4. –ê–Ω–∞–ª–∏–∑ –ü–∞—Ä—Ç–∏–π (Game Analysis)

**–ö–ª—é—á–µ–≤–∞—è —Ñ–∏—á–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

```typescript
// backend/src/analysis/analysis.service.ts
export class GameAnalysisService {
  async analyzeGame(gameId: string, depth = 20): Promise<GameAnalysis> {
    const game = await this.gameRepo.findWithMoves(gameId);
    const moves = game.moves;

    const analysis: MoveAnalysis[] = [];
    let currentFen = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';

    for (let i = 0; i < moves.length; i++) {
      const move = moves[i];

      // –ê–Ω–∞–ª–∏–∑ –ø–æ–∑–∏—Ü–∏–∏ –î–û —Ö–æ–¥–∞
      const engineResult = await this.engineManager.analyzePosition(
        currentFen,
        { depth, multipv: 3 } // Top 3 moves
      );

      // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Ö–æ–¥–∞
      const classification = this.classifyMove(
        move.uci,
        engineResult.bestMove,
        engineResult.evaluation,
        moves[i-1]?.evaluation
      );

      analysis.push({
        moveNumber: i + 1,
        move: move.san,
        evaluation: engineResult.evaluation,
        bestMove: engineResult.pv[0],
        classification,
        alternatives: engineResult.multipv,
      });

      currentFen = move.fen;
    }

    return {
      gameId,
      analysis,
      summary: this.generateSummary(analysis),
      accuracyWhite: this.calculateAccuracy(analysis, 'white'),
      accuracyBlack: this.calculateAccuracy(analysis, 'black'),
    };
  }

  classifyMove(
    playedMove: string,
    bestMove: string,
    currentEval: number,
    previousEval?: number
  ): MoveClassification {
    if (playedMove === bestMove) return 'best';

    const evalDrop = Math.abs(currentEval - (previousEval || 0));

    if (evalDrop < 25) return 'excellent';
    if (evalDrop < 50) return 'good';
    if (evalDrop < 100) return 'inaccuracy';
    if (evalDrop < 300) return 'mistake';
    return 'blunder';
  }

  generateSummary(analysis: MoveAnalysis[]): GameSummary {
    const white = analysis.filter((_, i) => i % 2 === 0);
    const black = analysis.filter((_, i) => i % 2 === 1);

    return {
      whiteBlunders: white.filter(m => m.classification === 'blunder').length,
      whiteMistakes: white.filter(m => m.classification === 'mistake').length,
      whiteInaccuracies: white.filter(m => m.classification === 'inaccuracy').length,

      blackBlunders: black.filter(m => m.classification === 'blunder').length,
      blackMistakes: black.filter(m => m.classification === 'mistake').length,
      blackInaccuracies: black.filter(m => m.classification === 'inaccuracy').length,

      openingPhase: this.detectOpening(analysis.slice(0, 10)),
      criticalMoment: this.findCriticalMoment(analysis),
    };
  }
}
```

**Frontend –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**

```typescript
// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (–∫–∞–∫ –Ω–∞ Chess.com)
const AdvantageChart: React.FC<{ analysis: GameAnalysis }> = ({ analysis }) => {
  return (
    <div className="advantage-chart">
      <svg width="100%" height="200">
        {analysis.analysis.map((move, i) => (
          <rect
            key={i}
            x={i * 10}
            y={100 - move.evaluation / 10}
            width={10}
            height={Math.abs(move.evaluation / 10)}
            fill={move.classification === 'blunder' ? 'red' :
                  move.classification === 'mistake' ? 'orange' :
                  move.classification === 'best' ? 'green' : 'gray'}
          />
        ))}
      </svg>
    </div>
  );
};
```

---

### 5. –î–µ–±—é—Ç–Ω–∞—è –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (Opening Book)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Opening Database Service         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  - ECO classification (500+ openings) ‚îÇ
‚îÇ  - Master game statistics             ‚îÇ
‚îÇ  - Win/Draw/Loss percentages          ‚îÇ
‚îÇ  - Popularity trends                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL + Full-Text Search        ‚îÇ
‚îÇ  - opening_positions table            ‚îÇ
‚îÇ  - opening_variations table           ‚îÇ
‚îÇ  - master_games table (PGN import)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Prisma Schema:**

```prisma
model Opening {
  id          String   @id @default(uuid())
  eco         String   // "E00", "B01", etc.
  name        String   // "King's Indian Defense"
  variation   String?  // "Classical Variation"
  fen         String   @unique
  pgn         String   // Moves in PGN
  popularity  Int      @default(0)

  // Statistics from master games
  whiteWins   Int      @default(0)
  draws       Int      @default(0)
  blackWins   Int      @default(0)
  totalGames  Int      @default(0)

  @@index([eco])
  @@index([name])
}

model MasterGame {
  id          String   @id @default(uuid())
  white       String
  black       String
  whiteElo    Int?
  blackElo    Int?
  result      String   // "1-0", "0-1", "1/2-1/2"
  date        DateTime
  event       String
  eco         String
  opening     String
  pgn         Text     // Full game in PGN

  @@index([eco])
  @@index([whiteElo, blackElo])
}
```

**Opening Explorer API:**

```typescript
// GET /api/openings/explore?fen=<fen>
@Get('explore')
async exploreOpening(@Query('fen') fen: string) {
  const position = await this.openingRepo.findByFen(fen);

  if (position) {
    // –ù–∞–π–¥–µ–Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
    return {
      opening: position.name,
      eco: position.eco,
      statistics: {
        whiteWins: position.whiteWins,
        draws: position.draws,
        blackWins: position.blackWins,
        total: position.totalGames,
      },
      nextMoves: await this.getPopularMoves(fen),
    };
  }

  return { opening: 'Unknown', nextMoves: [] };
}

async getPopularMoves(fen: string) {
  // –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –º–∞—Å—Ç–µ—Ä—Å–∫–∏—Ö –ø–∞—Ä—Ç–∏–π
  const games = await this.masterGameRepo.findByPosition(fen);
  const moveCounts = new Map<string, number>();

  for (const game of games) {
    const move = this.getNextMove(game.pgn, fen);
    moveCounts.set(move, (moveCounts.get(move) || 0) + 1);
  }

  return Array.from(moveCounts.entries())
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10)
    .map(([move, count]) => ({
      move,
      games: count,
      percentage: (count / games.length) * 100
    }));
}
```

**–ò–º–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

```bash
# –°–∫–∞—á–∞—Ç—å –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å PGN –±–∞–∑—É Lichess (6 billion games)
# https://database.lichess.org/

# Script –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
node scripts/import-pgn.js --file lichess_db_standard_rated_2025-01.pgn.zst
```

---

### 6. –¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ü–∞–∑–ª—ã (Tactical Puzzles)

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–∞–∑–ª–æ–≤:**

1. **Lichess Puzzle Database** (3+ million puzzles, open-source)
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –ø–∞—Ä—Ç–∏–π** (–¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ—Ç–∏–≤–æ–≤)

```prisma
model Puzzle {
  id          String   @id @default(uuid())
  fen         String
  moves       String   // UCI moves (solution)
  rating      Int      // Puzzle difficulty (1000-3000)
  popularity  Int
  themes      String[] // ["pin", "fork", "skewer", "mate_in_2"]

  // –î–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
  attempts    Int      @default(0)
  solved      Int      @default(0)

  @@index([rating])
  @@index([themes])
}

model UserPuzzleAttempt {
  id          String   @id @default(uuid())
  userId      String
  puzzleId    String
  solved      Boolean
  timeSpent   Int      // seconds
  attempts    Int
  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id])
  puzzle      Puzzle   @relation(fields: [puzzleId], references: [id])

  @@index([userId, createdAt])
}
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞:**

```typescript
export class PuzzleService {
  async getNextPuzzle(userId: string): Promise<Puzzle> {
    const user = await this.userRepo.findById(userId);
    const userPuzzleRating = user.puzzleRating || user.blitzRating;

    // –ü–æ–¥–±–æ—Ä –ø–∞–∑–ª–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ ¬±200 –æ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞
    const puzzle = await this.puzzleRepo.findRandom({
      rating: {
        gte: userPuzzleRating - 200,
        lte: userPuzzleRating + 200,
      },
      // –ò—Å–∫–ª—é—á–∞–µ–º –Ω–µ–¥–∞–≤–Ω–æ —Ä–µ—à–µ–Ω–Ω—ã–µ
      id: {
        notIn: await this.getRecentlySolved(userId, 100)
      }
    });

    return puzzle;
  }

  async submitSolution(userId: string, puzzleId: string, moves: string[]) {
    const puzzle = await this.puzzleRepo.findById(puzzleId);
    const correct = this.checkSolution(moves, puzzle.moves);

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –ø–∞–∑–ª–æ–≤ (Glicko-2)
    if (correct) {
      await this.updatePuzzleRating(userId, puzzle.rating, 1);
    } else {
      await this.updatePuzzleRating(userId, puzzle.rating, 0);
    }

    await this.attemptRepo.create({
      userId,
      puzzleId,
      solved: correct,
      timeSpent: /* ... */,
    });

    return { correct, solution: puzzle.moves };
  }
}
```

**–¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞:**

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–µ–º—É
const PUZZLE_THEMES = [
  'fork',
  'pin',
  'skewer',
  'discovered_attack',
  'double_check',
  'mate_in_1',
  'mate_in_2',
  'mate_in_3',
  'endgame',
  'opening',
  'middlegame',
  'sacrifice',
  'zugzwang',
];

// GET /api/puzzles/theme/fork
@Get('theme/:theme')
async getPuzzlesByTheme(@Param('theme') theme: string) {
  return this.puzzleRepo.findByTheme(theme, { limit: 20 });
}
```

---

### 7. –¢—É—Ä–Ω–∏—Ä—ã (Tournament System)

```prisma
enum TournamentType {
  ARENA       // –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π, –Ω–∞–±–æ—Ä –æ—á–∫–æ–≤
  SWISS       // –®–≤–µ–π—Ü–∞—Ä—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞
  KNOCKOUT    // –ù–∞ –≤—ã–ª–µ—Ç
}

model Tournament {
  id            String          @id @default(uuid())
  name          String
  type          TournamentType
  timeControl   String
  timeLimit     Int
  timeIncrement Int

  startTime     DateTime
  duration      Int             // minutes

  minRating     Int?
  maxRating     Int?
  maxPlayers    Int

  status        String          // "upcoming", "active", "finished"

  participants  TournamentParticipant[]
  games         Game[]

  createdBy     String
  createdAt     DateTime        @default(now())
}

model TournamentParticipant {
  id            String      @id @default(uuid())
  tournamentId  String
  userId        String
  score         Int         @default(0)
  gamesPlayed   Int         @default(0)
  wins          Int         @default(0)
  draws         Int         @default(0)
  losses        Int         @default(0)

  tournament    Tournament  @relation(fields: [tournamentId], references: [id])
  user          User        @relation(fields: [userId], references: [id])

  @@unique([tournamentId, userId])
}
```

**Arena Tournament (–∫–∞–∫ Lichess):**

```typescript
export class ArenaTournamentService {
  async runTournament(tournamentId: string) {
    const tournament = await this.repo.findById(tournamentId);
    const endTime = new Date(tournament.startTime.getTime() + tournament.duration * 60000);

    // –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∏—Ä–∏–Ω–≥–æ–≤
    while (Date.now() < endTime.getTime()) {
      const waitingPlayers = await this.getWaitingPlayers(tournamentId);

      if (waitingPlayers.length >= 2) {
        // –ü–∞–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–±–ª–∏–∑–∫–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∏)
        const pairs = this.pairPlayers(waitingPlayers);

        for (const [white, black] of pairs) {
          await this.gameService.create({
            whitePlayerId: white.userId,
            blackPlayerId: black.userId,
            tournamentId,
            timeControl: tournament.timeControl,
          });
        }
      }

      await this.sleep(5000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    }

    await this.finishTournament(tournamentId);
  }

  async updateScore(gameId: string) {
    const game = await this.gameService.findById(gameId);
    const points = {
      win: 2,
      draw: 1,
      loss: 0,
    };

    const whitePoints = game.winner === 'white' ? points.win :
                        game.winner === 'draw' ? points.draw : points.loss;

    await this.participantRepo.increment(
      game.whitePlayerId,
      { score: whitePoints, gamesPlayed: 1 }
    );
  }
}
```

---

### 8. –û–±—É—á–∞—é—â–∏–µ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (Learning Resources)

```prisma
model Lesson {
  id          String   @id @default(uuid())
  title       String
  description Text
  category    String   // "opening", "middlegame", "endgame", "tactics"
  difficulty  String   // "beginner", "intermediate", "advanced"
  content     Text     // Markdown/HTML

  // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
  positions   LessonPosition[]

  isPremium   Boolean  @default(false)
  views       Int      @default(0)

  createdAt   DateTime @default(now())
}

model LessonPosition {
  id          String   @id @default(uuid())
  lessonId    String
  fen         String
  instruction Text
  solution    String   // UCI moves
  order       Int

  lesson      Lesson   @relation(fields: [lessonId], references: [id])
}
```

**–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —É—Ä–æ–∫–∏:**

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–≥—Ä–∞–µ—Ç "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ" —Ö–æ–¥—ã
export class InteractiveLessonService {
  async checkMove(lessonId: string, positionId: string, move: string) {
    const position = await this.positionRepo.findById(positionId);
    const correctMoves = position.solution.split(' ');

    if (correctMoves.includes(move)) {
      return {
        correct: true,
        feedback: position.feedback,
        nextPosition: await this.getNextPosition(lessonId, position.order + 1)
      };
    } else {
      const hint = await this.engineService.analyzeMove(position.fen, move);
      return {
        correct: false,
        feedback: `This move allows ${hint.refutation}`,
        hint: correctMoves[0]
      };
    }
  }
}
```

---

### 9. –≠–Ω–¥—à–ø–∏–ª—å–Ω—ã–µ –¢–∞–±–ª–∏—Ü—ã (Syzygy Tablebases)

**Syzygy Tablebases** - –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è 7 —Ñ–∏–≥—É—Ä –∏ –º–µ–Ω–µ–µ.

```typescript
// backend/src/tablebase/tablebase.service.ts
import { execFile } from 'child_process';

export class TablebaseService {
  private syzygyPath = '/usr/share/syzygy'; // 6-man tablebases

  async probe(fen: string): Promise<TablebaseResult | null> {
    const pieceCount = this.countPieces(fen);

    if (pieceCount > 7) {
      return null; // –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ–∏–≥—É—Ä
    }

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º lichess API (–æ–Ω–ª–∞–π–Ω) –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –±–∞–∑—ã
    const result = await this.queryLichessTablebase(fen);

    return {
      dtm: result.dtm,        // Distance to mate
      dtz: result.dtz,        // Distance to zeroing move
      category: result.category, // "win", "loss", "draw"
      bestMove: result.moves[0].uci
    };
  }

  async queryLichessTablebase(fen: string) {
    // Lichess –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API –¥–ª—è 7-man tablebases
    const response = await fetch(
      `https://tablebase.lichess.ovh/standard?fen=${encodeURIComponent(fen)}`
    );
    return response.json();
  }
}
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∞–Ω–∞–ª–∏–∑:**

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
if (pieceCount <= 7) {
  const tbResult = await this.tablebaseService.probe(fen);
  if (tbResult) {
    return {
      type: 'tablebase',
      evaluation: tbResult.category === 'win' ? 10000 :
                  tbResult.category === 'loss' ? -10000 : 0,
      dtm: tbResult.dtm,
      bestMove: tbResult.bestMove
    };
  }
}
```

---

## üóÇÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Backend

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                    # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Telegram)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user/                    # –ü—Ä–æ—Ñ–∏–ª–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game/                    # –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game-clock.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ engine/                  # –®–∞—Ö–º–∞—Ç–Ω—ã–µ –¥–≤–∏–∂–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ engine-manager.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stockfish.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leela.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ komodo.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ engine-cache.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analysis/                # –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä—Ç–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game-analysis.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ opening-analysis.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ evaluation.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rating/                  # –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ glicko2.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rating.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ opening/                 # –î–µ–±—é—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ opening.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ opening-explorer.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pgn-import.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ puzzle/                  # –ü–∞–∑–ª—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ puzzle.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ puzzle-generator.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ adaptive-learning.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tournament/              # –¢—É—Ä–Ω–∏—Ä—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tournament.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ arena.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ swiss.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pairing.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson/                  # –û–±—É—á–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ interactive-lesson.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tablebase/               # –≠–Ω–¥—à–ø–∏–ª—å–Ω—ã–µ –±–∞–∑—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tablebase.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket/               # Real-time
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ game.gateway.ts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ tournament.gateway.ts
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ chat.gateway.ts
‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interceptors/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ decorators/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ prisma/
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îî‚îÄ‚îÄ test/
```

---

## üì± –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Frontend

```
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ features/                    # Feature-based structure
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChessBoard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MoveList.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameClock.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ EvaluationBar.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useChess.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useGameClock.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useOnlineGame.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GamePage.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SpectatorPage.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ store/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ gameSlice.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analysis/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AnalysisBoard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdvantageChart.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MoveClassification.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OpeningExplorer.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ AnalysisPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ puzzles/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PuzzleBoard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PuzzleHint.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PuzzleRating.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PuzzlePage.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PuzzleRush.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ThemePuzzles.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tournament/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TournamentCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Leaderboard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TournamentBracket.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TournamentList.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TournamentPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ learn/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LessonCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InteractivePosition.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ LessonPage.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ CoursePage.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ profile/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ RatingChart.tsx
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ GameHistory.tsx
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Statistics.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ ProfilePage.tsx
‚îÇ   ‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/           # UI Kit
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Modal.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Tabs.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Spinner.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useWebSocket.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useTelegram.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ chess.ts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ notation.ts
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ evaluation.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ websocket.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stockfish.ts
‚îÇ   ‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ slices/
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îî‚îÄ‚îÄ public/
    ‚îî‚îÄ‚îÄ engines/
        ‚îú‚îÄ‚îÄ stockfish.wasm
        ‚îî‚îÄ‚îÄ stockfish.js
```

---

## üöÄ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ü–ª–∞–Ω –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –û—Å–Ω–æ–≤—ã (2-3 –Ω–µ–¥–µ–ª–∏)

1. **–†–µ–∞–ª—å–Ω—ã–π Stockfish Backend** ‚úÖ –ö–†–ò–¢–ò–ß–ù–û
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ UCI protocol
   - Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - Queue —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
   - Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–í—Ä–µ–º–µ–Ω–Ω–æ–π –ö–æ–Ω—Ç—Ä–æ–ª—å** ‚úÖ –ö–†–ò–¢–ò–ß–ù–û
   - –ò–≥—Ä–æ–≤—ã–µ —á–∞—Å—ã —Å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º
   - WebSocket —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ timeout

3. **–†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è –°–∏—Å—Ç–µ–º–∞** ‚úÖ –ö–†–ò–¢–ò–ß–ù–û
   - Glicko-2 implementation
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ time controls
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –ø–æ—Å–ª–µ –ø–∞—Ä—Ç–∏–∏

4. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ú–∏–≥—Ä–∞—Ü–∏–∏ TypeORM ‚Üí Prisma**
   - –£–¥–∞–ª–∏—Ç—å legacy –∫–æ–¥
   - –ï–¥–∏–Ω–∞—è ORM

### –§–∞–∑–∞ 2: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –§–∏—á–∏ (3-4 –Ω–µ–¥–µ–ª–∏)

5. **–ê–Ω–∞–ª–∏–∑ –ü–∞—Ä—Ç–∏–π**
   - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —Ö–æ–¥–æ–≤
   - –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–º–µ–Ω—Ç–æ–≤
   - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

6. **–î–µ–±—é—Ç–Ω–∞—è –ë–∞–∑–∞**
   - –ò–º–ø–æ—Ä—Ç ECO –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - Opening Explorer
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ –º–∞—Å—Ç–µ—Ä—Å–∫–∏—Ö –ø–∞—Ä—Ç–∏–π
   - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è

7. **–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ü–∞–∑–ª—ã**
   - –ò–º–ø–æ—Ä—Ç Lichess puzzle database
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ–¥–±–æ—Ä –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
   - –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
   - Puzzle Rush —Ä–µ–∂–∏–º

### –§–∞–∑–∞ 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –§—É–Ω–∫—Ü–∏–∏ (4-6 –Ω–µ–¥–µ–ª—å)

8. **–¢—É—Ä–Ω–∏—Ä–Ω–∞—è –°–∏—Å—Ç–µ–º–∞**
   - Arena tournaments
   - Swiss system
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞–∏—Ä–∏–Ω–≥
   - Real-time leaderboards

9. **–û–±—É—á–∞—é—â–∏–µ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã**
   - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —É—Ä–æ–∫–∏
   - –í–∏–¥–µ–æ-–∫–æ–Ω—Ç–µ–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç—Ä–µ–∫–∏–Ω–≥

10. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –î–≤–∏–∂–∫–∏**
    - Leela Chess Zero (premium)
    - Komodo Dragon (personalities)
    - Multi-engine analysis

11. **–≠–Ω–¥—à–ø–∏–ª—å–Ω—ã–µ –¢–∞–±–ª–∏—Ü—ã**
    - Syzygy integration
    - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –∞–Ω–∞–ª–∏–∑–µ

### –§–∞–∑–∞ 4: –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –∏ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (ongoing)

12. **Premium –ü–æ–¥–ø–∏—Å–∫–∞**
    - –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ (depth 30+)
    - Leela Chess Zero
    - –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–∞–∑–ª—ã
    - –ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã

13. **Performance Optimization**
    - CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
    - Database indexing
    - WebSocket scaling (Redis adapter)
    - Caching strategy

14. **Analytics & Monitoring**
    - User behavior tracking
    - Performance metrics
    - Error tracking (Sentry)
    - A/B testing

---

## üí∞ –ë–∏–∑–Ω–µ—Å-–ú–æ–¥–µ–ª—å

### Free Tier (–ë–∞–∑–æ–≤—ã–π)
- ‚úÖ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã (–≤—Å–µ time controls)
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ (Stockfish depth 15)
- ‚úÖ 10 –ø–∞–∑–ª–æ–≤ –≤ –¥–µ–Ω—å
- ‚úÖ –£—á–∞—Å—Ç–∏–µ –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö
- ‚ö†Ô∏è –†–µ–∫–ª–∞–º–∞ (–Ω–µ–Ω–∞–≤—è–∑—á–∏–≤–∞—è)

### Premium ($4.99/–º–µ—Å—è—Ü –∏–ª–∏ $49.99/–≥–æ–¥)
- ‚úÖ –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ (depth 30+)
- ‚úÖ Leela Chess Zero –¥–æ—Å—Ç—É–ø
- ‚úÖ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–∞–∑–ª—ã
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã
- ‚úÖ –†–∞–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º

### Pro ($9.99/–º–µ—Å—è—Ü)
- ‚úÖ –í—Å–µ –∏–∑ Premium
- ‚úÖ Multi-engine analysis (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤–∏–∂–∫–æ–≤)
- ‚úÖ Cloud engine (–º–æ—â–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã)
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –£—Å–ø–µ—Ö–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ KPI:
- Engine analysis latency < 2s (depth 20)
- WebSocket latency < 100ms
- 99.9% uptime
- Database query time < 50ms
- Page load time < 1s

### –ë–∏–∑–Ω–µ—Å KPI:
- DAU (Daily Active Users)
- Retention (1-day, 7-day, 30-day)
- Games per user per day
- Premium conversion rate (target: 5-10%)
- Churn rate

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **Anti-Cheat System**
   - –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –¥–≤–∏–∂–∫–æ–≤
   - –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ö–æ–¥
   - –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∞–Ω–æ–º–∞–ª–∏—è (accuracy > 95% –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞)
   - Blur/focus —Å–æ–±—ã—Ç–∏—è (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–∫–Ω–∞)

2. **Rate Limiting**
   - API requests: 100 req/min
   - Analysis requests: 10 req/min (free), unlimited (premium)
   - Puzzle solving: 1 puzzle/10s

3. **Authentication**
   - Telegram auth (secure)
   - JWT tokens
   - Session management

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ npm –ø–∞–∫–µ—Ç—ã:

```json
{
  "backend": {
    "stockfish": "^16.0.0",
    "lc0": "^0.30.0",
    "@capacitor/filesystem": "^5.0.0",
    "pgn-parser": "^2.0.0",
    "chess.js": "^1.0.0",
    "@nestjs/bull": "^10.0.0",
    "bull": "^4.0.0",
    "ioredis": "^5.0.0"
  },
  "frontend": {
    "stockfish.wasm": "^0.11.0",
    "chessground": "^9.0.0",
    "react-chessboard": "^5.0.0",
    "recharts": "^2.0.0",
    "@tanstack/react-query": "^5.0.0"
  }
}
```

### –í–Ω–µ—à–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã:

- **Lichess Puzzle DB**: https://database.lichess.org/#puzzles
- **Master Games**: https://database.lichess.org/
- **ECO Codes**: https://github.com/niklasf/eco
- **Syzygy Tablebases**: https://tablebase.lichess.ovh/
- **Stockfish**: https://stockfishchess.org/
- **Leela**: https://lczero.org/

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å backend Stockfish (mock ‚Üí real)
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1:** –í—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å + —Ä–µ–π—Ç–∏–Ω–≥–∏
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2:** –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä—Ç–∏–π + –¥–µ–±—é—Ç—ã
4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3:** –ü–∞–∑–ª—ã + —Ç—É—Ä–Ω–∏—Ä—ã
5. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:** Leela Chess Zero, –æ–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è

**–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è –æ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤:**
- ‚ú® Telegram-native experience (haptic, payments, inline)
- ‚ú® –£–Ω–∏–∫–∞–ª—å–Ω—ã–π AI —Ç—Ä–µ–Ω–µ—Ä (–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
- ‚ú® –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–∏—á–∏ (Telegram –≥—Ä—É–ø–ø—ã, –∫–∞–Ω–∞–ª—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- ‚ú® –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏

---

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏

- [Best Chess Apps 2025](https://chesswatch.com/news/best-chess-training-services-and-tools-2025)
- [Chess.com vs Lichess Comparison](https://www.chess.com/blog/modipaduollemmers/which-of-the-apps-is-better-chess-com-or-lichess)
- [Top Chess Engines 2025](https://chessforsharks.co/top-chess-engines-in-2025/)
- [Stockfish vs Leela vs Komodo](https://www.attackingchess.com/top-10-strongest-chess-engines-in-2025/)
