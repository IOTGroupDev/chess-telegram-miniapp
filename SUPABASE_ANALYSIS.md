# Supabase –¥–ª—è Chess Telegram Mini App
## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ê–Ω–∞–ª–∏–∑ –∏ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 23 –Ω–æ—è–±—Ä—è 2025

---

## üéØ –ö—Ä–∞—Ç–∫–∏–π –û—Ç–≤–µ—Ç

**–î–ê, Supabase - –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä, –Ω–æ —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º:**
- ‚úÖ **Supabase** –¥–ª—è: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, Real-time –∏–≥—Ä—ã, Auth, Storage
- ‚úÖ **NestJS Backend** –¥–ª—è: –®–∞—Ö–º–∞—Ç–Ω—ã–µ –¥–≤–∏–∂–∫–∏ (Stockfish, Leela), –°–ª–æ–∂–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –õ—É—á—à–µ–µ –∏–∑ –æ–±–æ–∏—Ö –º–∏—Ä–æ–≤

---

## üìä Supabase vs –¢–µ–∫—É—â–∏–π –°—Ç–µ–∫

### –¢–µ–∫—É—â–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Frontend (React + Vite)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Backend (NestJS + Express)              ‚îÇ
‚îÇ  ‚îú‚îÄ WebSocket (Socket.io)                       ‚îÇ
‚îÇ  ‚îú‚îÄ REST API                                    ‚îÇ
‚îÇ  ‚îú‚îÄ Prisma ORM                                  ‚îÇ
‚îÇ  ‚îî‚îÄ Business Logic                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇPostgreSQL‚îÇ              ‚îÇ  Redis   ‚îÇ
‚îÇ(Database)‚îÇ              ‚îÇ (Cache)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù—É–∂–Ω–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å WebSocket scaling
- ‚ùå –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
- ‚ùå –ë–æ–ª—å—à–µ DevOps (deployment, monitoring, scaling)
- ‚ùå Socket.io —Ç—Ä–µ–±—É–µ—Ç sticky sessions –¥–ª—è scaling

---

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Supabase (100% Supabase)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Frontend (React + Vite)               ‚îÇ
‚îÇ  ‚îú‚îÄ @supabase/supabase-js                       ‚îÇ
‚îÇ  ‚îú‚îÄ Supabase Realtime (WebSocket)               ‚îÇ
‚îÇ  ‚îî‚îÄ Direct DB queries                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Supabase Platform                  ‚îÇ
‚îÇ  ‚îú‚îÄ PostgreSQL (Managed)                        ‚îÇ
‚îÇ  ‚îú‚îÄ Realtime Engine (WebSocket)                 ‚îÇ
‚îÇ  ‚îú‚îÄ Authentication                              ‚îÇ
‚îÇ  ‚îú‚îÄ Storage (–¥–ª—è PGN, –∞–≤–∞—Ç–∞—Ä—ã)                  ‚îÇ
‚îÇ  ‚îú‚îÄ Edge Functions (Serverless)                 ‚îÇ
‚îÇ  ‚îî‚îÄ Row Level Security                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å Stockfish/Leela** (–Ω–µ—Ç child_process)
- ‚ùå Edge Functions –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚ùå –°–ª–æ–∂–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Ä–µ–π—Ç–∏–Ω–≥–∏ Glicko-2, –∞–Ω–∞–ª–∏–∑) –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- ‚ùå –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

---

### üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–ê–Ø: –ì–∏–±—Ä–∏–¥–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Frontend (React + Vite)                   ‚îÇ
‚îÇ  ‚îú‚îÄ @supabase/supabase-js (–¥–ª—è –∏–≥—Ä)                    ‚îÇ
‚îÇ  ‚îú‚îÄ Axios (–¥–ª—è Engine API)                             ‚îÇ
‚îÇ  ‚îî‚îÄ Supabase Realtime (WebSocket)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ                      ‚îÇ
             ‚ñº                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Supabase Platform    ‚îÇ  ‚îÇ  NestJS Engine Service   ‚îÇ
‚îÇ  ‚îú‚îÄ PostgreSQL         ‚îÇ  ‚îÇ  ‚îú‚îÄ Stockfish Engine     ‚îÇ
‚îÇ  ‚îú‚îÄ Realtime Sync      ‚îÇ  ‚îÇ  ‚îú‚îÄ Leela Chess Zero     ‚îÇ
‚îÇ  ‚îú‚îÄ Auth (optional)    ‚îÇ  ‚îÇ  ‚îú‚îÄ Komodo Dragon        ‚îÇ
‚îÇ  ‚îú‚îÄ Storage (PGN)      ‚îÇ  ‚îÇ  ‚îú‚îÄ Analysis Service     ‚îÇ
‚îÇ  ‚îî‚îÄ Game State         ‚îÇ  ‚îÇ  ‚îú‚îÄ Rating Calculator    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  ‚îî‚îÄ Queue (Bull)         ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                                      ‚ñº
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ  Redis (Cache)   ‚îÇ
                            ‚îÇ  - Positions     ‚îÇ
                            ‚îÇ  - Bull Queue    ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | –ì–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –ü–æ—á–µ–º—É |
|-----------|----------------|--------|
| **–ò–≥—Ä–æ–≤—ã–µ –ø–∞—Ä—Ç–∏–∏** | Supabase | Real-time sync –∏–∑ –∫–æ—Ä–æ–±–∫–∏ |
| **–í—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å** | Supabase Realtime | Broadcast —Ç–∞–π–º–µ—Ä–∞ |
| **–•–æ–¥—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è** | Supabase (RLS) | Row Level Security |
| **–ò—Å—Ç–æ—Ä–∏—è –ø–∞—Ä—Ç–∏–π** | Supabase | PostgreSQL —Å auto-generated API |
| **–†–µ–π—Ç–∏–Ω–≥–∏ (–¥–∞–Ω–Ω—ã–µ)** | Supabase | –•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** | Supabase | –ü—Ä–æ—Ñ–∏–ª–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| **–î–µ–±—é—Ç–Ω–∞—è –±–∞–∑–∞** | Supabase | PostgreSQL –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ |
| | | |
| **Stockfish/Leela** | NestJS | child_process, –¥–æ–ª–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è |
| **–ê–Ω–∞–ª–∏–∑ –ø–∞—Ä—Ç–∏–π** | NestJS | –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **–†–∞—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤** | NestJS | Glicko-2 –∞–ª–≥–æ—Ä–∏—Ç–º |
| **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–∑–ª–æ–≤** | NestJS | Computational heavy |
| **Tournament pairing** | NestJS | –°–ª–æ–∂–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã |

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Supabase –¥–ª—è –®–∞—Ö–º–∞—Ç

### 1. Real-Time Game Sync (üî• –ì–ª–∞–≤–Ω–æ–µ!)

**–ë–µ–∑ Supabase (Socket.io):**

```typescript
// Backend - –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å
@WebSocketGateway()
export class GameGateway {
  @SubscribeMessage('makeMove')
  async handleMove(client: Socket, payload: MoveDto) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    const game = await this.gameService.makeMove(payload);

    // Broadcast –≤—Å–µ–º –≤ –∫–æ–º–Ω–∞—Ç–µ
    this.server.to(payload.gameId).emit('moveUpdate', game);

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
    this.server.to(payload.gameId).emit('clockUpdate', clock);
  }
}

// –ü—Ä–æ–±–ª–µ–º—ã scaling:
// - Sticky sessions
// - Redis adapter –¥–ª—è multi-instance
// - –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
```

**–° Supabase Realtime:**

```typescript
// Frontend - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è!
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏
useEffect(() => {
  const channel = supabase
    .channel(`game:${gameId}`)
    .on('postgres_changes',
      {
        event: 'UPDATE',
        schema: 'public',
        table: 'games',
        filter: `id=eq.${gameId}`
      },
      (payload) => {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        setGame(payload.new);
      }
    )
    .subscribe();

  return () => supabase.removeChannel(channel);
}, [gameId]);

// –•–æ–¥ –∏–≥—Ä–æ–∫–∞
const makeMove = async (move: Move) => {
  // –ü—Ä–æ—Å—Ç–æ UPDATE –≤ –±–∞–∑—É - –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
  const { data, error } = await supabase
    .from('games')
    .update({
      fen: newFen,
      lastMove: move,
      updatedAt: new Date()
    })
    .eq('id', gameId);
};
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ—Ç –∫–æ–¥–∞ –¥–ª—è WebSocket —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π scaling (Supabase —É–ø—Ä–∞–≤–ª—è–µ—Ç)
- ‚úÖ Reconnection handling –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ Presence API (–∫—Ç–æ –æ–Ω–ª–∞–π–Ω) –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ Broadcast –¥–ª—è —ç—Ñ–µ–º–µ—Ä–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–∞–π–º–µ—Ä)

### 2. Supabase Realtime Features –¥–ª—è –®–∞—Ö–º–∞—Ç

#### A) Broadcast (–¥–ª—è —Ç–∞–π–º–µ—Ä–∞)

```typescript
// Broadcast –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î - –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ç–∞–π–º–µ—Ä–∞!
const channel = supabase.channel(`game:${gameId}`);

// –û—Ç–ø—Ä–∞–≤–∫–∞ tick –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
setInterval(() => {
  channel.send({
    type: 'broadcast',
    event: 'clock-tick',
    payload: {
      whiteTime: clock.whiteTime,
      blackTime: clock.blackTime,
      activePlayer: 'white'
    }
  });
}, 1000);

// –ü–æ–ª—É—á–µ–Ω–∏–µ
channel.on('broadcast', { event: 'clock-tick' }, (payload) => {
  setClock(payload.payload);
});
```

#### B) Presence (–∫—Ç–æ –æ–Ω–ª–∞–π–Ω)

```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω –∏–≥—Ä–æ–∫–æ–≤
const channel = supabase.channel(`game:${gameId}`);

// –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
channel.on('presence', { event: 'sync' }, () => {
  const state = channel.presenceState();
  console.log('Online players:', Object.keys(state));
});

channel.subscribe(async (status) => {
  if (status === 'SUBSCRIBED') {
    await channel.track({
      user_id: userId,
      online_at: new Date().toISOString()
    });
  }
});
```

#### C) Postgres Changes (–¥–ª—è —Ö–æ–¥–æ–≤)

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ö–æ–¥–æ–≤
supabase
  .channel('moves')
  .on('postgres_changes',
    {
      event: 'INSERT',
      schema: 'public',
      table: 'moves',
      filter: `game_id=eq.${gameId}`
    },
    (payload) => {
      // –ù–æ–≤—ã–π —Ö–æ–¥ - –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å–∫—É
      addMoveToBoard(payload.new);
    }
  )
  .subscribe();
```

### 3. Row Level Security (RLS)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —á–∏—Ç–æ–≤:**

```sql
-- –¢–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å —Ö–æ–¥—ã
CREATE POLICY "Players can make moves"
ON moves FOR INSERT
TO authenticated
USING (
  auth.uid() IN (
    SELECT white_player_id FROM games WHERE id = game_id
    UNION
    SELECT black_player_id FROM games WHERE id = game_id
  )
  AND
  -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ —Ö–æ–¥–∞
  (
    (auth.uid() = (SELECT white_player_id FROM games WHERE id = game_id)
     AND (SELECT move_number FROM games WHERE id = game_id) % 2 = 0)
    OR
    (auth.uid() = (SELECT black_player_id FROM games WHERE id = game_id)
     AND (SELECT move_number FROM games WHERE id = game_id) % 2 = 1)
  )
);

-- –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –ø–∞—Ä—Ç–∏—é
CREATE POLICY "View own games"
ON games FOR SELECT
TO authenticated
USING (
  auth.uid() = white_player_id
  OR auth.uid() = black_player_id
  OR is_public = true
);
```

### 4. Auto-Generated APIs

```typescript
// –í–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è REST endpoints:
// GET /api/games/:userId
// Supabase –¥–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π API:

const { data: games } = await supabase
  .from('games')
  .select(`
    *,
    white_player:users!white_player_id(username, rating),
    black_player:users!black_player_id(username, rating),
    moves(*)
  `)
  .or(`white_player_id.eq.${userId},black_player_id.eq.${userId}`)
  .order('created_at', { ascending: false })
  .limit(20);

// Type-safe —Å TypeScript!
```

### 5. Storage –¥–ª—è PGN –∏ –ê–≤–∞—Ç–∞—Ä—ã

```typescript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PGN –ø–∞—Ä—Ç–∏–∏
const { data, error } = await supabase.storage
  .from('pgn-files')
  .upload(`games/${gameId}.pgn`, pgnContent, {
    contentType: 'application/x-chess-pgn'
  });

// –ü—É–±–ª–∏—á–Ω—ã–π URL
const { data: { publicUrl } } = supabase.storage
  .from('pgn-files')
  .getPublicUrl(`games/${gameId}.pgn`);

// –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å: publicUrl
```

---

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ Supabase –¥–ª—è –®–∞—Ö–º–∞—Ç

### 1. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å Stockfish

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Stockfish/Leela - —ç—Ç–æ native binaries (C++)
- –¢—Ä–µ–±—É—é—Ç `child_process.spawn()` –∏–∑ Node.js
- Supabase Edge Functions = Deno runtime (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π)

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–¥–µ–ª—å–Ω—ã–π NestJS —Å–µ—Ä–≤–∏—Å –¥–ª—è –¥–≤–∏–∂–∫–æ–≤

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Edge Functions

```typescript
// Edge Function timeout = 60 —Å–µ–∫—É–Ω–¥ –º–∞–∫—Å–∏–º—É–º
// –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ Stockfish (depth 30) –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å > 60 —Å–µ–∫!

// –ü–ª—é—Å –Ω–µ—Ç file system –¥–ª—è Syzygy tablebases
```

**–†–µ—à–µ–Ω–∏–µ:** NestJS backend —Å Bull Queue –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

### 3. –°–ª–æ–∂–Ω–∞—è –ë–∏–∑–Ω–µ—Å-–õ–æ–≥–∏–∫–∞

**Glicko-2 Rating Calculation:**
```typescript
// –≠—Ç–æ –ª—É—á—à–µ –Ω–∞ backend, –Ω–µ –≤ Edge Function
export class Glicko2Service {
  calculateNewRating(player, opponents, results) {
    // –°–ª–æ–∂–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
    // 200+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
    // –õ—É—á—à–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  }
}
```

### 4. –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏

**Supabase Pricing (2025):**

| Tier | Price | Limits |
|------|-------|--------|
| **Free** | $0 | 500MB DB, 2GB storage, 50K MAU |
| **Pro** | $25/mo | 8GB DB, 100GB storage, 100K MAU |
| **Team** | $599/mo | 50GB DB, 500GB storage, 500K MAU |

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ 100K+ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –¥–æ—Ä–æ–≥–æ

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π PostgreSQL + Supabase —Ç–æ–ª—å–∫–æ –¥–ª—è Realtime

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω—ã–π Supabase + NestJS Microservice (üî• –†–ï–ö–û–ú–ï–ù–î–£–Æ)

```
Frontend ‚Üí Supabase (95% –∑–∞–ø—Ä–æ—Å–æ–≤)
        ‚Üì
        NestJS Engine Service (5% - —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑)
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```typescript
// ===================================
// 1. SUPABASE SCHEMA
// ===================================

-- games table
CREATE TABLE games (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  white_player_id UUID REFERENCES users(id),
  black_player_id UUID REFERENCES users(id),

  status TEXT CHECK (status IN ('waiting', 'active', 'finished')),
  winner TEXT CHECK (winner IN ('white', 'black', 'draw')),

  fen TEXT NOT NULL DEFAULT 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',
  pgn TEXT,

  time_control TEXT NOT NULL, -- 'blitz', 'rapid', etc.
  time_limit INT NOT NULL,
  time_increment INT NOT NULL,

  white_time_remaining INT,
  black_time_remaining INT,

  move_number INT DEFAULT 0,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  started_at TIMESTAMPTZ,
  finished_at TIMESTAMPTZ
);

-- moves table
CREATE TABLE moves (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  game_id UUID REFERENCES games(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id),

  move_number INT NOT NULL,
  uci TEXT NOT NULL,
  san TEXT NOT NULL,
  fen TEXT NOT NULL,

  time_spent INT, -- milliseconds
  clock_time INT, -- remaining time after move

  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable Realtime
ALTER PUBLICATION supabase_realtime ADD TABLE games;
ALTER PUBLICATION supabase_realtime ADD TABLE moves;

-- RLS Policies
ALTER TABLE games ENABLE ROW LEVEL SECURITY;
ALTER TABLE moves ENABLE ROW LEVEL SECURITY;

-- Policy: Players can view their games
CREATE POLICY "view_own_games" ON games
  FOR SELECT USING (
    auth.uid() IN (white_player_id, black_player_id)
    OR status = 'finished' -- finished games are public
  );

-- Policy: Players can update their games (for draw offers, resign)
CREATE POLICY "update_own_games" ON games
  FOR UPDATE USING (
    auth.uid() IN (white_player_id, black_player_id)
  );

-- Policy: Players can insert moves (only their turn)
CREATE POLICY "insert_own_moves" ON moves
  FOR INSERT WITH CHECK (
    auth.uid() = user_id
    AND EXISTS (
      SELECT 1 FROM games g
      WHERE g.id = game_id
      AND (
        (auth.uid() = g.white_player_id AND g.move_number % 2 = 0)
        OR (auth.uid() = g.black_player_id AND g.move_number % 2 = 1)
      )
    )
  );


// ===================================
// 2. FRONTEND (React + Supabase)
// ===================================

// hooks/useSupabaseGame.ts
export const useSupabaseGame = (gameId: string) => {
  const [game, setGame] = useState<Game | null>(null);
  const [moves, setMoves] = useState<Move[]>([]);
  const supabase = useSupabaseClient();

  useEffect(() => {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä—Ç–∏–∏
    const fetchGame = async () => {
      const { data } = await supabase
        .from('games')
        .select('*, moves(*)')
        .eq('id', gameId)
        .single();

      setGame(data);
      setMoves(data.moves);
    };

    fetchGame();

    // Real-time –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    const channel = supabase
      .channel(`game:${gameId}`)

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏ (—Å—Ç–∞—Ç—É—Å, –ø–æ–±–µ–¥–∏—Ç–µ–ª—å)
      .on('postgres_changes',
        { event: 'UPDATE', schema: 'public', table: 'games', filter: `id=eq.${gameId}` },
        (payload) => setGame(payload.new as Game)
      )

      // –ù–æ–≤—ã–µ —Ö–æ–¥—ã
      .on('postgres_changes',
        { event: 'INSERT', schema: 'public', table: 'moves', filter: `game_id=eq.${gameId}` },
        (payload) => setMoves(prev => [...prev, payload.new as Move])
      )

      // –¢–∞–π–º–µ—Ä (broadcast - –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î)
      .on('broadcast', { event: 'clock-tick' }, ({ payload }) => {
        setGame(prev => ({
          ...prev,
          white_time_remaining: payload.whiteTime,
          black_time_remaining: payload.blackTime
        }));
      })

      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [gameId]);

  const makeMove = async (move: { from: string; to: string; promotion?: string }) => {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (chess.js)
    const chess = new Chess(game.fen);
    const result = chess.move(move);

    if (!result) {
      throw new Error('Invalid move');
    }

    // –í—Å—Ç–∞–≤–∫–∞ –≤ –ë–î - RLS –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø—Ä–∞–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    const { data, error } = await supabase
      .from('moves')
      .insert({
        game_id: gameId,
        user_id: (await supabase.auth.getUser()).data.user?.id,
        move_number: game.move_number + 1,
        uci: `${move.from}${move.to}${move.promotion || ''}`,
        san: result.san,
        fen: chess.fen(),
        time_spent: /* calculate */,
      });

    if (error) throw error;

    // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏
    await supabase
      .from('games')
      .update({
        fen: chess.fen(),
        move_number: game.move_number + 1,
        pgn: chess.pgn(),
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–∞/–ø–∞—Ç–∞
        status: chess.isGameOver() ? 'finished' : 'active',
        winner: chess.isCheckmate() ? (chess.turn() === 'w' ? 'black' : 'white') :
                chess.isDraw() ? 'draw' : null,
      })
      .eq('id', gameId);

    // –í—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è!
  };

  return { game, moves, makeMove };
};


// ===================================
// 3. NestJS ENGINE SERVICE (–û—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å)
// ===================================

// engine-service/src/analysis/analysis.controller.ts
@Controller('analysis')
export class AnalysisController {
  constructor(private stockfish: StockfishService) {}

  @Post('position')
  async analyzePosition(@Body() dto: { fen: string; depth: number }) {
    // –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    const cached = await this.cache.get(`analysis:${dto.fen}:${dto.depth}`);
    if (cached) return cached;

    // –ê–Ω–∞–ª–∏–∑ Stockfish
    const result = await this.stockfish.analyzePosition(dto.fen, dto.depth);

    await this.cache.set(`analysis:${dto.fen}:${dto.depth}`, result, 3600);
    return result;
  }

  @Post('game/:gameId')
  async analyzeGame(@Param('gameId') gameId: string) {
    // –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä—Ç–∏—é –∏–∑ Supabase
    const { data: game } = await this.supabaseClient
      .from('games')
      .select('*, moves(*)')
      .eq('id', gameId)
      .single();

    // –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å (Bull)
    const job = await this.analysisQueue.add('analyze-game', {
      gameId,
      moves: game.moves
    });

    return { jobId: job.id };
  }
}

// Processor –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
@Processor('analysis-queue')
export class AnalysisProcessor {
  @Process('analyze-game')
  async handleGameAnalysis(job: Job) {
    const { gameId, moves } = job.data;

    const analysis = [];
    for (const move of moves) {
      const result = await this.stockfish.analyzePosition(move.fen, 20);
      analysis.push({
        move: move.san,
        evaluation: result.evaluation,
        classification: this.classifyMove(result)
      });

      job.progress((analysis.length / moves.length) * 100);
    }

    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Supabase
    await this.supabaseClient
      .from('game_analysis')
      .insert({
        game_id: gameId,
        analysis: analysis,
        completed_at: new Date()
      });

    return analysis;
  }
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Supabase —Ç–æ–ª—å–∫–æ –¥–ª—è Realtime

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π PostgreSQL, –Ω–æ Supabase Realtime —Å–≤–µ—Ä—Ö—É:

```typescript
// Supabase –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≤–∞—à–µ–º—É PostgreSQL
// https://supabase.com/docs/guides/database/connecting-to-postgres

// docker-compose.yml
services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: chess
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # Supabase Realtime layer
  realtime:
    image: supabase/realtime:latest
    environment:
      DB_HOST: postgres
      DB_PORT: 5432
```

---

## üí∞ –ê–Ω–∞–ª–∏–∑ –°—Ç–æ–∏–º–æ—Å—Ç–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π: 10,000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**Option 1: –¢–æ–ª—å–∫–æ NestJS (–±–µ–∑ Supabase)**

| –°–µ—Ä–≤–∏—Å | –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–µ—Å—è—Ü |
|--------|----------------|
| VPS (4 CPU, 8GB RAM) | $40 |
| PostgreSQL (managed, 25GB) | $25 |
| Redis (managed, 1GB) | $15 |
| CDN | $10 |
| **–ò–¢–û–ì–û** | **$90/–º–µ—Å** |

**Option 2: Supabase Pro + NestJS –¥–ª—è –¥–≤–∏–∂–∫–æ–≤**

| –°–µ—Ä–≤–∏—Å | –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–µ—Å—è—Ü |
|--------|----------------|
| Supabase Pro | $25 |
| NestJS VPS (2 CPU, 4GB) | $20 |
| Redis –¥–ª—è –∫–µ—à–∞ | $10 |
| CDN | $10 |
| **–ò–¢–û–ì–û** | **$65/–º–µ—Å** |

**–≠–∫–æ–Ω–æ–º–∏—è: $25/–º–µ—Å + –º–µ–Ω—å—à–µ DevOps —Ä–∞–±–æ—Ç—ã**

---

## üöÄ –ü–ª–∞–Ω –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Supabase

### –§–∞–∑–∞ 1: Setup (1 –Ω–µ–¥–µ–ª—è)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å Supabase –ø—Ä–æ–µ–∫—Ç
npx supabase init

# 2. –ú–∏–≥—Ä–∞—Ü–∏—è schema
npx supabase db push

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç
npm install @supabase/supabase-js
```

### –§–∞–∑–∞ 2: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (1-2 –Ω–µ–¥–µ–ª–∏)

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å Supabase schema (tables, RLS policies)
2. ‚úÖ –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (users, games, moves)
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Realtime –¥–ª—è games/moves tables
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å Storage buckets (pgn-files, avatars)

### –§–∞–∑–∞ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Frontend (2 –Ω–µ–¥–µ–ª–∏)

1. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å WebSocket –Ω–∞ Supabase Realtime
2. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å API calls –Ω–∞ Supabase queries
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å Supabase Auth (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–∑–∞ 4: Backend Refactoring (1 –Ω–µ–¥–µ–ª—è)

1. ‚úÖ –£–¥–∞–ª–∏—Ç—å Prisma/TypeORM (–Ω–µ –Ω—É–∂–Ω—ã)
2. ‚úÖ –£–¥–∞–ª–∏—Ç—å WebSocket gateway
3. ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Engine service + Analysis
4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–õ–Ø –í–ê–®–ï–ì–û –ü–†–û–ï–ö–¢–ê: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ü–æ–¥—Ö–æ–¥ üéØ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   95% –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ ‚Üí Supabase            ‚îÇ
‚îÇ   ‚îú‚îÄ –ü–∞—Ä—Ç–∏–∏ (CRUD + Realtime)           ‚îÇ
‚îÇ   ‚îú‚îÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏                       ‚îÇ
‚îÇ   ‚îú‚îÄ –†–µ–π—Ç–∏–Ω–≥–∏ (—Ö—Ä–∞–Ω–µ–Ω–∏–µ)                ‚îÇ
‚îÇ   ‚îú‚îÄ –ò—Å—Ç–æ—Ä–∏—è                            ‚îÇ
‚îÇ   ‚îú‚îÄ –¢—É—Ä–Ω–∏—Ä—ã (–¥–∞–Ω–Ω—ã–µ)                   ‚îÇ
‚îÇ   ‚îî‚îÄ Storage (PGN, –∞–≤–∞—Ç–∞—Ä—ã)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   5% –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ ‚Üí NestJS               ‚îÇ
‚îÇ   ‚îú‚îÄ Stockfish Engine                   ‚îÇ
‚îÇ   ‚îú‚îÄ Leela Chess Zero                   ‚îÇ
‚îÇ   ‚îú‚îÄ Komodo Dragon                      ‚îÇ
‚îÇ   ‚îú‚îÄ Game Analysis                      ‚îÇ
‚îÇ   ‚îú‚îÄ Rating Calculation (Glicko-2)      ‚îÇ
‚îÇ   ‚îú‚îÄ Puzzle Generation                  ‚îÇ
‚îÇ   ‚îî‚îÄ Tournament Pairing                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—á–µ–º—É —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ª—É—á—à–∏–π:

1. ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:** Supabase —É–±–∏—Ä–∞–µ—Ç 80% boilerplate –∫–æ–¥–∞
2. ‚úÖ **Real-time –∏–∑ –∫–æ—Ä–æ–±–∫–∏:** –ù–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å WebSocket scaling
3. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** RLS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —á–∏—Ç–æ–≤
4. ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å:** –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ NestJS
5. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –î–≤–∏–∂–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞—Ç–∏–≤–Ω–æ (C++)
6. ‚úÖ **–°—Ç–æ–∏–º–æ—Å—Ç—å:** –î–µ—à–µ–≤–ª–µ, —á–µ–º –ø–æ–ª–Ω—ã–π —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π backend
7. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:** Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ scaling –¥–æ 100K+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ß—Ç–æ –ù–ï –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –Ω–∞ Supabase:

- ‚ùå –®–∞—Ö–º–∞—Ç–Ω—ã–µ –¥–≤–∏–∂–∫–∏ (Stockfish, Leela, Komodo)
- ‚ùå –î–ª–∏–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–∞—Ä—Ç–∏–π (> 60 —Å–µ–∫)
- ‚ùå –°–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è (Glicko-2)
- ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–∑–ª–æ–≤
- ‚ùå –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π (–ª—É—á—à–µ Redis)

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏

### Supabase –¥–ª—è Real-Time Games:
- [Supabase Realtime with Multiplayer Features](https://supabase.com/blog/supabase-realtime-with-multiplayer-features)
- [Real-Time Multiplayer with Supabase Realtime](https://vibe-studio.ai/insights/real-time-multiplayer-with-supabase-realtime-and-flutter)
- [Supabase Realtime Documentation](https://supabase.com/docs/guides/realtime)
- [Multiplayer Browser Game with Supabase](https://dev.to/iakabu/i-built-a-real-time-multiplayer-browser-game-with-supabase-nextjs-no-backend-server-required-h28)

### Supabase vs Custom Backend:
- [Supabase vs Prisma: Feature Comparison](https://www.leanware.co/insights/supabase-vs-prisma)
- [Backend Choices: BaaS vs Supabase vs NestJS](https://ititans.com/blog/backend-choices-baas-vs-supabase-vs-nestjs/)
- [Prisma vs Supabase for Your Project](https://www.buttercups.tech/blog/back-end/prisma-vs-supabase-which-is-right-for-your-project)
- [Using Prisma with Supabase](https://supabase.com/docs/guides/database/prisma)

---

## üé¨ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

–•–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ Supabase? –Ø –º–æ–≥—É:

1. **–°–æ–∑–¥–∞—Ç—å Supabase schema** (tables, RLS policies)
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Real-time game sync** (–≤–º–µ—Å—Ç–æ Socket.io)
3. **–û–±–Ω–æ–≤–∏—Ç—å frontend** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
4. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ backend** (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–≤–∏–∂–∫–∏)

–ß—Ç–æ –≤—ã–±–µ—Ä–µ—Ç–µ? üöÄ
